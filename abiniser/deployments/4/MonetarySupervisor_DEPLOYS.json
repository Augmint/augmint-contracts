{
  "contractName": "MonetarySupervisor",
  "latestAbiHash": "a552ee1f90ae83cb91d07311ae8eab1e",
  "deployedAbis": {
    "066c2220b91befd25691fefd91684117": {
      "latestDeployedAddress": "0x02a3b0f6ab5998a0c5d756ed01ea2200ea68d763",
      "deployments": {
        "0xd0c273bb6023611f166e92105232fb225392013b": {
          "generatedAt": "2018-04-25T12:29:07.564Z",
          "truffleContractFileUpdatedAt": "2018-02-14T23:29:32.214Z",
          "compiler": {
            "name": "solc",
            "version": "0.4.19+commit.c4cbbb05.Emscripten.clang"
          },
          "bytecodeHash": "0c0d7f8840d3267bcc4625b5d0b07c6b",
          "deployedBytecodeHash": "2931a2d6f8a22994a9f4ed26ac04aa59",
          "sourceHash": "3d16faed337b9adec2d66024be645249",
          "source": "/* MonetarySupervisor\n    - maintains system wide KPIs (eg totalLockAmount, totalLoanAmount)\n    - holds system wide parameters/limits\n    - enforces system wide limits\n    - burns and issues to AugmintReserves\n    - Send funds from reserve to exchange when intervening (not implemented yet)\n\n    TODO:\n        - MonetarySupervisorInterface (and use it everywhere)\n        - interestEarnedAccount setter?\n        - create and use InterestEarnedAccount interface instead?\n\n*/\n\npragma solidity 0.4.19;\nimport \"./generic/SafeMath.sol\";\nimport \"./generic/Restricted.sol\";\nimport \"./interfaces/AugmintTokenInterface.sol\";\nimport \"./InterestEarnedAccount.sol\";\nimport \"./AugmintReserves.sol\";\n\n\ncontract MonetarySupervisor is Restricted { // solhint-disable-line no-empty-blocks\n    using SafeMath for uint256;\n\n    AugmintTokenInterface public augmintToken;\n    InterestEarnedAccount public interestEarnedAccount;\n    AugmintReserves public augmintReserves;\n\n    uint public issuedByMonetaryBoard; // supply issued manually by monetary board\n\n    uint public totalLoanAmount; // total amount of all loans without interest, in token\n    uint public totalLockedAmount; // total amount of all locks without premium, in token\n\n    /* Parameters Used to ensure totalLoanAmount or totalLockedAmount difference is withing limit and system also works\n        when any of those 0 or low. */\n    uint public ltdDifferenceLimit;     /* allow lock or loan if Loan To Deposut ratio stay within 1 +- this param\n                                            stored as parts per million */\n    uint public allowedLtdDifferenceAmount; /* in token - if totalLoan and totalLock difference is less than that\n                                             then allow loan or lock even if ltdDifference limit would go off with it */\n\n    event ParamsChanged(uint ltdDifferenceLimit, uint allowedLtdDifferenceAmount);\n\n    function MonetarySupervisor(AugmintTokenInterface _augmintToken, AugmintReserves _augmintReserves,\n        InterestEarnedAccount _interestEarnedAccount,\n        uint _ltdDifferenceLimit, uint _allowedLtdDifferenceAmount) public {\n        augmintToken = _augmintToken;\n        augmintReserves = _augmintReserves;\n        interestEarnedAccount = _interestEarnedAccount;\n\n        ltdDifferenceLimit = _ltdDifferenceLimit;\n        allowedLtdDifferenceAmount = _allowedLtdDifferenceAmount;\n    }\n\n    function issueToReserve(uint amount) external restrict(\"MonetaryBoard\") {\n        issuedByMonetaryBoard = issuedByMonetaryBoard.add(amount);\n        augmintToken.issueTo(augmintReserves, amount);\n    }\n\n    function burnFromReserve(uint amount) external restrict(\"MonetaryBoard\") {\n        issuedByMonetaryBoard = issuedByMonetaryBoard.sub(amount);\n        augmintReserves.burn(augmintToken, amount);\n    }\n\n    // Locker requesting interest when locking funds\n    function requestInterest(uint amountToLock, uint interestAmount) external {\n        require(permissions[msg.sender][\"LockerContracts\"]); // only whitelisted LockerContracts\n        /* TODO: enforce LTD limits (ltdDifferenceLimit & allowedLtdDifferenceAmount) */\n\n        totalLockedAmount = totalLockedAmount.add(amountToLock);\n        interestEarnedAccount.transferInterest(augmintToken, msg.sender, interestAmount); // transfer interest to Locker\n    }\n\n    // Locker notifying when releasing funds to update KPIs\n    function releaseFundsNotification(uint lockedAmount) external {\n        require(permissions[msg.sender][\"LockerContracts\"]); // only whitelisted LockerContracts\n        totalLockedAmount = totalLockedAmount.sub(lockedAmount);\n    }\n\n    function issueLoan(address borrower, uint loanAmount) external {\n        require(permissions[msg.sender][\"LoanManagerContracts\"]); // only whitelisted LoanManager contracts\n        totalLoanAmount = totalLoanAmount.add(loanAmount);\n        augmintToken.issueTo(borrower, loanAmount);\n    }\n\n    function loanRepaymentNotification(uint loanAmount) external {\n        require(permissions[msg.sender][\"LoanManagerContracts\"]); // only whitelisted Lender contracts\n        totalLoanAmount = totalLoanAmount.sub(loanAmount);\n    }\n\n    // NB: this is called by Lender contract with the sum of all loans collected in batch\n    function loanCollectionNotification(uint totalLoanAmountCollected) external {\n        require(permissions[msg.sender][\"LoanManagerContracts\"]); // only whitelisted Lender contracts\n        totalLoanAmount = totalLoanAmount.sub(totalLoanAmountCollected);\n    }\n\n    function setParams(uint _ltdDifferenceLimit, uint _allowedLtdDifferenceAmount)\n    external restrict(\"MonetaryBoard\") {\n        ltdDifferenceLimit = _ltdDifferenceLimit;\n        allowedLtdDifferenceAmount = _allowedLtdDifferenceAmount;\n\n        ParamsChanged(ltdDifferenceLimit, allowedLtdDifferenceAmount);\n    }\n\n    // helper function for FrontEnd to reduce calls\n    function getParams() external view returns(uint[2]) {\n        return [ltdDifferenceLimit, allowedLtdDifferenceAmount];\n    }\n\n}\n"
        },
        "0x02a3b0f6ab5998a0c5d756ed01ea2200ea68d763": {
          "generatedAt": "2018-04-25T12:30:49.339Z",
          "truffleContractFileUpdatedAt": "2018-02-27T07:36:28.104Z",
          "compiler": {
            "name": "solc",
            "version": "0.4.19+commit.c4cbbb05.Emscripten.clang"
          },
          "bytecodeHash": "aaa00593c08a52c6bbce73d97d28e20a",
          "deployedBytecodeHash": "6a662f2eb12115963b51303c0a7a0912",
          "sourceHash": "3d16faed337b9adec2d66024be645249",
          "source": "/* MonetarySupervisor\n    - maintains system wide KPIs (eg totalLockAmount, totalLoanAmount)\n    - holds system wide parameters/limits\n    - enforces system wide limits\n    - burns and issues to AugmintReserves\n    - Send funds from reserve to exchange when intervening (not implemented yet)\n\n    TODO:\n        - MonetarySupervisorInterface (and use it everywhere)\n        - interestEarnedAccount setter?\n        - create and use InterestEarnedAccount interface instead?\n\n*/\n\npragma solidity 0.4.19;\nimport \"./generic/SafeMath.sol\";\nimport \"./generic/Restricted.sol\";\nimport \"./interfaces/AugmintTokenInterface.sol\";\nimport \"./InterestEarnedAccount.sol\";\nimport \"./AugmintReserves.sol\";\n\n\ncontract MonetarySupervisor is Restricted { // solhint-disable-line no-empty-blocks\n    using SafeMath for uint256;\n\n    AugmintTokenInterface public augmintToken;\n    InterestEarnedAccount public interestEarnedAccount;\n    AugmintReserves public augmintReserves;\n\n    uint public issuedByMonetaryBoard; // supply issued manually by monetary board\n\n    uint public totalLoanAmount; // total amount of all loans without interest, in token\n    uint public totalLockedAmount; // total amount of all locks without premium, in token\n\n    /* Parameters Used to ensure totalLoanAmount or totalLockedAmount difference is withing limit and system also works\n        when any of those 0 or low. */\n    uint public ltdDifferenceLimit;     /* allow lock or loan if Loan To Deposut ratio stay within 1 +- this param\n                                            stored as parts per million */\n    uint public allowedLtdDifferenceAmount; /* in token - if totalLoan and totalLock difference is less than that\n                                             then allow loan or lock even if ltdDifference limit would go off with it */\n\n    event ParamsChanged(uint ltdDifferenceLimit, uint allowedLtdDifferenceAmount);\n\n    function MonetarySupervisor(AugmintTokenInterface _augmintToken, AugmintReserves _augmintReserves,\n        InterestEarnedAccount _interestEarnedAccount,\n        uint _ltdDifferenceLimit, uint _allowedLtdDifferenceAmount) public {\n        augmintToken = _augmintToken;\n        augmintReserves = _augmintReserves;\n        interestEarnedAccount = _interestEarnedAccount;\n\n        ltdDifferenceLimit = _ltdDifferenceLimit;\n        allowedLtdDifferenceAmount = _allowedLtdDifferenceAmount;\n    }\n\n    function issueToReserve(uint amount) external restrict(\"MonetaryBoard\") {\n        issuedByMonetaryBoard = issuedByMonetaryBoard.add(amount);\n        augmintToken.issueTo(augmintReserves, amount);\n    }\n\n    function burnFromReserve(uint amount) external restrict(\"MonetaryBoard\") {\n        issuedByMonetaryBoard = issuedByMonetaryBoard.sub(amount);\n        augmintReserves.burn(augmintToken, amount);\n    }\n\n    // Locker requesting interest when locking funds\n    function requestInterest(uint amountToLock, uint interestAmount) external {\n        require(permissions[msg.sender][\"LockerContracts\"]); // only whitelisted LockerContracts\n        /* TODO: enforce LTD limits (ltdDifferenceLimit & allowedLtdDifferenceAmount) */\n\n        totalLockedAmount = totalLockedAmount.add(amountToLock);\n        interestEarnedAccount.transferInterest(augmintToken, msg.sender, interestAmount); // transfer interest to Locker\n    }\n\n    // Locker notifying when releasing funds to update KPIs\n    function releaseFundsNotification(uint lockedAmount) external {\n        require(permissions[msg.sender][\"LockerContracts\"]); // only whitelisted LockerContracts\n        totalLockedAmount = totalLockedAmount.sub(lockedAmount);\n    }\n\n    function issueLoan(address borrower, uint loanAmount) external {\n        require(permissions[msg.sender][\"LoanManagerContracts\"]); // only whitelisted LoanManager contracts\n        totalLoanAmount = totalLoanAmount.add(loanAmount);\n        augmintToken.issueTo(borrower, loanAmount);\n    }\n\n    function loanRepaymentNotification(uint loanAmount) external {\n        require(permissions[msg.sender][\"LoanManagerContracts\"]); // only whitelisted Lender contracts\n        totalLoanAmount = totalLoanAmount.sub(loanAmount);\n    }\n\n    // NB: this is called by Lender contract with the sum of all loans collected in batch\n    function loanCollectionNotification(uint totalLoanAmountCollected) external {\n        require(permissions[msg.sender][\"LoanManagerContracts\"]); // only whitelisted Lender contracts\n        totalLoanAmount = totalLoanAmount.sub(totalLoanAmountCollected);\n    }\n\n    function setParams(uint _ltdDifferenceLimit, uint _allowedLtdDifferenceAmount)\n    external restrict(\"MonetaryBoard\") {\n        ltdDifferenceLimit = _ltdDifferenceLimit;\n        allowedLtdDifferenceAmount = _allowedLtdDifferenceAmount;\n\n        ParamsChanged(ltdDifferenceLimit, allowedLtdDifferenceAmount);\n    }\n\n    // helper function for FrontEnd to reduce calls\n    function getParams() external view returns(uint[2]) {\n        return [ltdDifferenceLimit, allowedLtdDifferenceAmount];\n    }\n\n}\n"
        }
      }
    },
    "a552ee1f90ae83cb91d07311ae8eab1e": {
      "latestDeployedAddress": "0xa00a5d1882c3f690e3d0d975ebe378120b70ae87",
      "deployments": {
        "0x2e8b07a973f8e136aa39922dff21ad187a6e8e7d": {
          "generatedAt": "2018-04-25T12:31:29.126Z",
          "truffleContractFileUpdatedAt": "2018-04-20T18:26:53.540Z",
          "deployTransactionHash": "0x7f8049914c355bcc0f9ac0e3dd381b0e2fc90cc077769511a34aac136c0d08d5",
          "compiler": {
            "name": "solc",
            "version": "0.4.23+commit.124ca40d.Emscripten.clang"
          },
          "bytecodeHash": "c245a44ab31d54b7b6cde54eb3d96a7c",
          "deployedBytecodeHash": "83c21b4ee2d4acec62a24c09234c3a1d",
          "sourceHash": "5c1b006109344523977cb1bf8fd493d8",
          "source": "/* MonetarySupervisor\n    - maintains system wide KPIs (eg totalLockAmount, totalLoanAmount)\n    - holds system wide parameters/limits\n    - enforces system wide limits\n    - burns and issues to AugmintReserves\n    - Send funds from reserve to exchange when intervening (not implemented yet)\n    - Converts older versions of AugmintTokens in 1:1 to new\n\n    TODO:\n        - Mcreate and use MonetarySupervisorInterface?\n        - create and use InterestEarnedAccount interface ?\n\n*/\n\npragma solidity ^0.4.23;\nimport \"./generic/SafeMath.sol\";\nimport \"./generic/Restricted.sol\";\nimport \"./interfaces/AugmintTokenInterface.sol\";\nimport \"./interfaces/TokenReceiver.sol\";\nimport \"./InterestEarnedAccount.sol\";\nimport \"./AugmintReserves.sol\";\n\n\ncontract MonetarySupervisor is Restricted, TokenReceiver { // solhint-disable-line no-empty-blocks\n    using SafeMath for uint256;\n\n    uint public constant PERCENT_100 = 1000000;\n\n    AugmintTokenInterface public augmintToken;\n    InterestEarnedAccount public interestEarnedAccount;\n    AugmintReserves public augmintReserves;\n\n    uint public issuedByMonetaryBoard; // supply issued manually by monetary board\n\n    uint public totalLoanAmount; // total amount of all loans without interest, in token\n    uint public totalLockedAmount; // total amount of all locks without premium, in token\n\n    /**********\n        Parameters to ensure totalLoanAmount or totalLockedAmount difference is within limits and system also works\n        when total loan or lock amounts are low.\n            for test calculations: https://docs.google.com/spreadsheets/d/1MeWYPYZRIm1n9lzpvbq8kLfQg1hhvk5oJY6NrR401S0\n    **********/\n    struct LtdParams {\n        uint  lockDifferenceLimit; /* only allow a new lock if Loan To Deposit ratio would stay above\n                                            (1 - lockDifferenceLimit) with new lock. Stored as parts per million */\n        uint  loanDifferenceLimit; /* only allow a new loan if Loan To Deposit ratio would stay above\n                                            (1 + loanDifferenceLimit) with new loan. Stored as parts per million */\n        /* allowedDifferenceAmount param is to ensure the system is not \"freezing\" when totalLoanAmount or\n            totalLockAmount is low.\n        It allows a new loan or lock (up to an amount to reach this difference) even if LTD will go below / above\n            lockDifferenceLimit / loanDifferenceLimit with the new lock/loan */\n        uint  allowedDifferenceAmount;\n    }\n\n    LtdParams public ltdParams;\n\n    /* Previously deployed AugmintTokens which are accepted for conversion (see transferNotification() )\n        NB: it's not iterable so old version addresses needs to be added for UI manually after each deploy */\n    mapping(address => bool) public acceptedLegacyAugmintTokens;\n\n    event LtdParamsChanged(uint lockDifferenceLimit, uint loanDifferenceLimit, uint allowedDifferenceAmount);\n\n    event AcceptedLegacyAugmintTokenChanged(address augmintTokenAddress, bool newAcceptedState);\n\n    event LegacyTokenConverted(address oldTokenAddress, address account, uint amount);\n\n    event KPIsAdjusted(uint totalLoanAmountAdjustment, uint totalLockedAmountAdjustment);\n\n    event SystemContractsChanged(InterestEarnedAccount newInterestEarnedAccount, AugmintReserves newAugmintReserves);\n\n    constructor(AugmintTokenInterface _augmintToken, AugmintReserves _augmintReserves,\n        InterestEarnedAccount _interestEarnedAccount,\n        uint lockDifferenceLimit, uint loanDifferenceLimit, uint allowedDifferenceAmount) public {\n        augmintToken = _augmintToken;\n        augmintReserves = _augmintReserves;\n        interestEarnedAccount = _interestEarnedAccount;\n\n        ltdParams = LtdParams(lockDifferenceLimit, loanDifferenceLimit, allowedDifferenceAmount);\n    }\n\n    function issueToReserve(uint amount) external restrict(\"MonetaryBoard\") {\n        issuedByMonetaryBoard = issuedByMonetaryBoard.add(amount);\n        augmintToken.issueTo(augmintReserves, amount);\n    }\n\n    function burnFromReserve(uint amount) external restrict(\"MonetaryBoard\") {\n        issuedByMonetaryBoard = issuedByMonetaryBoard.sub(amount);\n        augmintReserves.burn(augmintToken, amount);\n    }\n\n    /* Locker requesting interest when locking funds. Enforcing LTD to stay within range allowed by LTD params\n        NB: it does not know about min loan amount, it's the loan contract's responsibility to enforce it  */\n    function requestInterest(uint amountToLock, uint interestAmount) external {\n        // only whitelisted LockerContracts\n        require(permissions[msg.sender][\"LockerContracts\"], \"msg.sender must have LockerContracts permission\");\n        require(amountToLock <= getMaxLockAmountAllowedByLtd(), \"amountToLock must be <= maxLockAmountAllowedByLtd\");\n\n        totalLockedAmount = totalLockedAmount.add(amountToLock);\n        // next line would revert but require to emit reason:\n        require(augmintToken.balanceOf(address(interestEarnedAccount)) >= interestAmount,\n            \"interestEarnedAccount balance must be >= interestAmount\");\n        interestEarnedAccount.transferInterest(augmintToken, msg.sender, interestAmount); // transfer interest to Locker\n    }\n\n    // Locker notifying when releasing funds to update KPIs\n    function releaseFundsNotification(uint lockedAmount) external {\n        // only whitelisted LockerContracts\n        require(permissions[msg.sender][\"LockerContracts\"], \"msg.sender must have LockerContracts permission\");\n        totalLockedAmount = totalLockedAmount.sub(lockedAmount);\n    }\n\n    /* Issue loan if LTD stays within range allowed by LTD params\n        NB: it does not know about min loan amount, it's the loan contract's responsibility to enforce it */\n    function issueLoan(address borrower, uint loanAmount) external {\n         // only whitelisted LoanManager contracts\n        require(permissions[msg.sender][\"LoanManagerContracts\"],\n            \"msg.sender must have LoanManagerContracts permission\");\n        require(loanAmount <= getMaxLoanAmountAllowedByLtd(), \"loanAmount must be <= maxLoanAmountAllowedByLtd\");\n        totalLoanAmount = totalLoanAmount.add(loanAmount);\n        augmintToken.issueTo(borrower, loanAmount);\n    }\n\n    function loanRepaymentNotification(uint loanAmount) external {\n        // only whitelisted LoanManager contracts\n       require(permissions[msg.sender][\"LoanManagerContracts\"],\n           \"msg.sender must have LoanManagerContracts permission\");\n        totalLoanAmount = totalLoanAmount.sub(loanAmount);\n    }\n\n    // NB: this is called by Lender contract with the sum of all loans collected in batch\n    function loanCollectionNotification(uint totalLoanAmountCollected) external {\n        // only whitelisted LoanManager contracts\n       require(permissions[msg.sender][\"LoanManagerContracts\"],\n           \"msg.sender must have LoanManagerContracts permission\");\n        totalLoanAmount = totalLoanAmount.sub(totalLoanAmountCollected);\n    }\n\n    function setAcceptedLegacyAugmintToken(address legacyAugmintTokenAddress, bool newAcceptedState)\n    external restrict(\"MonetaryBoard\") {\n        acceptedLegacyAugmintTokens[legacyAugmintTokenAddress] = newAcceptedState;\n        emit AcceptedLegacyAugmintTokenChanged(legacyAugmintTokenAddress, newAcceptedState);\n    }\n\n    function setLtdParams(uint lockDifferenceLimit, uint loanDifferenceLimit, uint allowedDifferenceAmount)\n    external restrict(\"MonetaryBoard\") {\n        ltdParams = LtdParams(lockDifferenceLimit, loanDifferenceLimit, allowedDifferenceAmount);\n\n        emit LtdParamsChanged(lockDifferenceLimit, loanDifferenceLimit, allowedDifferenceAmount);\n    }\n\n    /* function to migrate old totalLoanAmount and totalLockedAmount from old monetarySupervisor contract\n        when it's upgraded.\n        Set new monetarySupervisor contract in all locker and loanManager contracts before executing this */\n    function adjustKPIs(uint totalLoanAmountAdjustment, uint totalLockedAmountAdjustment)\n    external restrict(\"MonetaryBoard\") {\n        totalLoanAmount = totalLoanAmount.add(totalLoanAmountAdjustment);\n        totalLockedAmount = totalLockedAmount.add(totalLockedAmountAdjustment);\n\n        emit KPIsAdjusted(totalLoanAmountAdjustment, totalLockedAmountAdjustment);\n    }\n\n    /* to allow upgrades of InterestEarnedAccount and AugmintReserves contracts. */\n    function setSystemContracts(InterestEarnedAccount newInterestEarnedAccount, AugmintReserves newAugmintReserves)\n    external restrict(\"MonetaryBoard\") {\n        interestEarnedAccount = newInterestEarnedAccount;\n        augmintReserves = newAugmintReserves;\n        emit SystemContractsChanged(newInterestEarnedAccount, newAugmintReserves);\n    }\n\n    /* User can request to convert their tokens from older AugmintToken versions in 1:1\n      transferNotification is called from AugmintToken's transferAndNotify\n     Flow for converting old tokens:\n        1) user calls old token contract's transferAndNotify with the amount to convert,\n                addressing the new MonetarySupervisor Contract\n        2) transferAndNotify transfers user's old tokens to the current MonetarySupervisor contract's address\n        3) transferAndNotify calls MonetarySupervisor.transferNotification\n        4) MonetarySupervisor checks if old AugmintToken is permitted\n        5) MonetarySupervisor issues new tokens to user's account in current AugmintToken\n        6) MonetarySupervisor burns old tokens from own balance\n    */\n    function transferNotification(address from, uint amount, uint /* data, not used */ ) external {\n        AugmintTokenInterface legacyToken = AugmintTokenInterface(msg.sender);\n        require(acceptedLegacyAugmintTokens[legacyToken], \"msg.sender must be allowed in acceptedLegacyAugmintTokens\");\n\n        legacyToken.burn(amount);\n        augmintToken.issueTo(from, amount);\n        emit LegacyTokenConverted(msg.sender, from, amount);\n    }\n\n    function getLoanToDepositRatio() external view returns (uint loanToDepositRatio) {\n        loanToDepositRatio = totalLockedAmount == 0 ? 0 : totalLockedAmount.mul(PERCENT_100).div(totalLoanAmount);\n    }\n\n    /* Helper function for UI.\n        Returns max lock amount based on minLockAmount, interestPt, using LTD params & interestEarnedAccount balance */\n    function getMaxLockAmount(uint minLockAmount, uint interestPt) external view returns (uint maxLock) {\n        uint allowedByEarning = augmintToken.balanceOf(address(interestEarnedAccount)).mul(PERCENT_100).div(interestPt);\n        uint allowedByLtd = getMaxLockAmountAllowedByLtd();\n        maxLock = allowedByEarning < allowedByLtd ? allowedByEarning : allowedByLtd;\n        maxLock = maxLock < minLockAmount ? 0 : maxLock;\n    }\n\n    /* Helper function for UI.\n        Returns max loan amount based on minLoanAmont using LTD params */\n    function getMaxLoanAmount(uint minLoanAmount) external view returns (uint maxLoan) {\n        uint allowedByLtd = getMaxLoanAmountAllowedByLtd();\n        maxLoan = allowedByLtd < minLoanAmount ? 0 : allowedByLtd;\n    }\n\n    /* returns maximum lockable token amount allowed by LTD params. */\n    function getMaxLockAmountAllowedByLtd() public view returns(uint maxLockByLtd) {\n        uint allowedByLtdDifferencePt = totalLoanAmount.mul(PERCENT_100).div(PERCENT_100\n                                            .sub(ltdParams.lockDifferenceLimit));\n        allowedByLtdDifferencePt = totalLockedAmount >= allowedByLtdDifferencePt ?\n                                        0 : allowedByLtdDifferencePt.sub(totalLockedAmount);\n\n        uint allowedByLtdDifferenceAmount =\n            totalLoanAmount > totalLockedAmount.add(ltdParams.allowedDifferenceAmount) ?\n                0 : totalLoanAmount.add(ltdParams.allowedDifferenceAmount).sub(totalLockedAmount);\n\n        maxLockByLtd = allowedByLtdDifferencePt > allowedByLtdDifferenceAmount ?\n                                        allowedByLtdDifferencePt : allowedByLtdDifferenceAmount;\n    }\n\n    /* returns maximum borrowable token amount allowed by LTD params */\n    function getMaxLoanAmountAllowedByLtd() public view returns(uint maxLoanByLtd) {\n        uint allowedByLtdDifferencePt = totalLockedAmount.mul(ltdParams.loanDifferenceLimit.add(PERCENT_100))\n                                            .div(PERCENT_100);\n        allowedByLtdDifferencePt = totalLoanAmount >= allowedByLtdDifferencePt ?\n                                        0 : allowedByLtdDifferencePt.sub(totalLoanAmount);\n\n        uint allowedByLtdDifferenceAmount =\n            totalLoanAmount > totalLockedAmount.add(ltdParams.allowedDifferenceAmount) ?\n                0 : totalLockedAmount.add(ltdParams.allowedDifferenceAmount).sub(totalLoanAmount);\n\n        maxLoanByLtd = allowedByLtdDifferencePt > allowedByLtdDifferenceAmount ?\n                                        allowedByLtdDifferencePt : allowedByLtdDifferenceAmount;\n    }\n\n}\n"
        },
        "0xa00a5d1882c3f690e3d0d975ebe378120b70ae87": {
          "generatedAt": "2018-04-27T00:06:09.883Z",
          "truffleContractFileUpdatedAt": "2018-04-27T00:02:50.106Z",
          "deployTransactionHash": "0x00c619309e8bada11d4cdc415c460799d1455f020a57bea5a2df5f636d506351",
          "compiler": {
            "name": "solc",
            "version": "0.4.23+commit.124ca40d.Emscripten.clang"
          },
          "bytecodeHash": "c41181b91537cc751d880d79baf095dd",
          "deployedBytecodeHash": "afc07e949d0fc0522760e21001e6442e",
          "sourceHash": "cbd67b35e74bbbc9ef5a78c3180eb002",
          "source": "/* MonetarySupervisor\n    - maintains system wide KPIs (eg totalLockAmount, totalLoanAmount)\n    - holds system wide parameters/limits\n    - enforces system wide limits\n    - burns and issues to AugmintReserves\n    - Send funds from reserve to exchange when intervening (not implemented yet)\n    - Converts older versions of AugmintTokens in 1:1 to new\n\n    TODO:\n        - Mcreate and use MonetarySupervisorInterface?\n        - create and use InterestEarnedAccount interface ?\n\n*/\n\npragma solidity ^0.4.23;\nimport \"./generic/SafeMath.sol\";\nimport \"./generic/Restricted.sol\";\nimport \"./interfaces/AugmintTokenInterface.sol\";\nimport \"./interfaces/TokenReceiver.sol\";\nimport \"./InterestEarnedAccount.sol\";\nimport \"./AugmintReserves.sol\";\n\n\ncontract MonetarySupervisor is Restricted, TokenReceiver { // solhint-disable-line no-empty-blocks\n    using SafeMath for uint256;\n\n    uint public constant PERCENT_100 = 1000000;\n\n    AugmintTokenInterface public augmintToken;\n    InterestEarnedAccount public interestEarnedAccount;\n    AugmintReserves public augmintReserves;\n\n    uint public issuedByMonetaryBoard; // supply issued manually by monetary board\n\n    uint public totalLoanAmount; // total amount of all loans without interest, in token\n    uint public totalLockedAmount; // total amount of all locks without premium, in token\n\n    /**********\n        Parameters to ensure totalLoanAmount or totalLockedAmount difference is within limits and system also works\n        when total loan or lock amounts are low.\n            for test calculations: https://docs.google.com/spreadsheets/d/1MeWYPYZRIm1n9lzpvbq8kLfQg1hhvk5oJY6NrR401S0\n    **********/\n    struct LtdParams {\n        uint  lockDifferenceLimit; /* only allow a new lock if Loan To Deposit ratio would stay above\n                                            (1 - lockDifferenceLimit) with new lock. Stored as parts per million */\n        uint  loanDifferenceLimit; /* only allow a new loan if Loan To Deposit ratio would stay above\n                                            (1 + loanDifferenceLimit) with new loan. Stored as parts per million */\n        /* allowedDifferenceAmount param is to ensure the system is not \"freezing\" when totalLoanAmount or\n            totalLockAmount is low.\n        It allows a new loan or lock (up to an amount to reach this difference) even if LTD will go below / above\n            lockDifferenceLimit / loanDifferenceLimit with the new lock/loan */\n        uint  allowedDifferenceAmount;\n    }\n\n    LtdParams public ltdParams;\n\n    /* Previously deployed AugmintTokens which are accepted for conversion (see transferNotification() )\n        NB: it's not iterable so old version addresses needs to be added for UI manually after each deploy */\n    mapping(address => bool) public acceptedLegacyAugmintTokens;\n\n    event LtdParamsChanged(uint lockDifferenceLimit, uint loanDifferenceLimit, uint allowedDifferenceAmount);\n\n    event AcceptedLegacyAugmintTokenChanged(address augmintTokenAddress, bool newAcceptedState);\n\n    event LegacyTokenConverted(address oldTokenAddress, address account, uint amount);\n\n    event KPIsAdjusted(uint totalLoanAmountAdjustment, uint totalLockedAmountAdjustment);\n\n    event SystemContractsChanged(InterestEarnedAccount newInterestEarnedAccount, AugmintReserves newAugmintReserves);\n\n    constructor(AugmintTokenInterface _augmintToken, AugmintReserves _augmintReserves,\n        InterestEarnedAccount _interestEarnedAccount,\n        uint lockDifferenceLimit, uint loanDifferenceLimit, uint allowedDifferenceAmount) public {\n        augmintToken = _augmintToken;\n        augmintReserves = _augmintReserves;\n        interestEarnedAccount = _interestEarnedAccount;\n\n        ltdParams = LtdParams(lockDifferenceLimit, loanDifferenceLimit, allowedDifferenceAmount);\n    }\n\n    function issueToReserve(uint amount) external restrict(\"MonetaryBoard\") {\n        issuedByMonetaryBoard = issuedByMonetaryBoard.add(amount);\n        augmintToken.issueTo(augmintReserves, amount);\n    }\n\n    function burnFromReserve(uint amount) external restrict(\"MonetaryBoard\") {\n        issuedByMonetaryBoard = issuedByMonetaryBoard.sub(amount);\n        augmintReserves.burn(augmintToken, amount);\n    }\n\n    /* Locker requesting interest when locking funds. Enforcing LTD to stay within range allowed by LTD params\n        NB: it does not know about min loan amount, it's the loan contract's responsibility to enforce it  */\n    function requestInterest(uint amountToLock, uint interestAmount) external {\n        // only whitelisted LockerContracts\n        require(permissions[msg.sender][\"LockerContracts\"], \"msg.sender must have LockerContracts permission\");\n        require(amountToLock <= getMaxLockAmountAllowedByLtd(), \"amountToLock must be <= maxLockAmountAllowedByLtd\");\n\n        totalLockedAmount = totalLockedAmount.add(amountToLock);\n        // next line would revert but require to emit reason:\n        require(augmintToken.balanceOf(address(interestEarnedAccount)) >= interestAmount,\n            \"interestEarnedAccount balance must be >= interestAmount\");\n        interestEarnedAccount.transferInterest(augmintToken, msg.sender, interestAmount); // transfer interest to Locker\n    }\n\n    // Locker notifying when releasing funds to update KPIs\n    function releaseFundsNotification(uint lockedAmount) external {\n        // only whitelisted LockerContracts\n        require(permissions[msg.sender][\"LockerContracts\"], \"msg.sender must have LockerContracts permission\");\n        totalLockedAmount = totalLockedAmount.sub(lockedAmount);\n    }\n\n    /* Issue loan if LTD stays within range allowed by LTD params\n        NB: it does not know about min loan amount, it's the loan contract's responsibility to enforce it */\n    function issueLoan(address borrower, uint loanAmount) external {\n         // only whitelisted LoanManager contracts\n        require(permissions[msg.sender][\"LoanManagerContracts\"],\n            \"msg.sender must have LoanManagerContracts permission\");\n        require(loanAmount <= getMaxLoanAmountAllowedByLtd(), \"loanAmount must be <= maxLoanAmountAllowedByLtd\");\n        totalLoanAmount = totalLoanAmount.add(loanAmount);\n        augmintToken.issueTo(borrower, loanAmount);\n    }\n\n    function loanRepaymentNotification(uint loanAmount) external {\n        // only whitelisted LoanManager contracts\n       require(permissions[msg.sender][\"LoanManagerContracts\"],\n           \"msg.sender must have LoanManagerContracts permission\");\n        totalLoanAmount = totalLoanAmount.sub(loanAmount);\n    }\n\n    // NB: this is called by Lender contract with the sum of all loans collected in batch\n    function loanCollectionNotification(uint totalLoanAmountCollected) external {\n        // only whitelisted LoanManager contracts\n       require(permissions[msg.sender][\"LoanManagerContracts\"],\n           \"msg.sender must have LoanManagerContracts permission\");\n        totalLoanAmount = totalLoanAmount.sub(totalLoanAmountCollected);\n    }\n\n    function setAcceptedLegacyAugmintToken(address legacyAugmintTokenAddress, bool newAcceptedState)\n    external restrict(\"MonetaryBoard\") {\n        acceptedLegacyAugmintTokens[legacyAugmintTokenAddress] = newAcceptedState;\n        emit AcceptedLegacyAugmintTokenChanged(legacyAugmintTokenAddress, newAcceptedState);\n    }\n\n    function setLtdParams(uint lockDifferenceLimit, uint loanDifferenceLimit, uint allowedDifferenceAmount)\n    external restrict(\"MonetaryBoard\") {\n        ltdParams = LtdParams(lockDifferenceLimit, loanDifferenceLimit, allowedDifferenceAmount);\n\n        emit LtdParamsChanged(lockDifferenceLimit, loanDifferenceLimit, allowedDifferenceAmount);\n    }\n\n    /* function to migrate old totalLoanAmount and totalLockedAmount from old monetarySupervisor contract\n        when it's upgraded.\n        Set new monetarySupervisor contract in all locker and loanManager contracts before executing this */\n    function adjustKPIs(uint totalLoanAmountAdjustment, uint totalLockedAmountAdjustment)\n    external restrict(\"MonetaryBoard\") {\n        totalLoanAmount = totalLoanAmount.add(totalLoanAmountAdjustment);\n        totalLockedAmount = totalLockedAmount.add(totalLockedAmountAdjustment);\n\n        emit KPIsAdjusted(totalLoanAmountAdjustment, totalLockedAmountAdjustment);\n    }\n\n    /* to allow upgrades of InterestEarnedAccount and AugmintReserves contracts. */\n    function setSystemContracts(InterestEarnedAccount newInterestEarnedAccount, AugmintReserves newAugmintReserves)\n    external restrict(\"MonetaryBoard\") {\n        interestEarnedAccount = newInterestEarnedAccount;\n        augmintReserves = newAugmintReserves;\n        emit SystemContractsChanged(newInterestEarnedAccount, newAugmintReserves);\n    }\n\n    /* User can request to convert their tokens from older AugmintToken versions in 1:1\n      transferNotification is called from AugmintToken's transferAndNotify\n     Flow for converting old tokens:\n        1) user calls old token contract's transferAndNotify with the amount to convert,\n                addressing the new MonetarySupervisor Contract\n        2) transferAndNotify transfers user's old tokens to the current MonetarySupervisor contract's address\n        3) transferAndNotify calls MonetarySupervisor.transferNotification\n        4) MonetarySupervisor checks if old AugmintToken is permitted\n        5) MonetarySupervisor issues new tokens to user's account in current AugmintToken\n        6) MonetarySupervisor burns old tokens from own balance\n    */\n    function transferNotification(address from, uint amount, uint /* data, not used */ ) external {\n        AugmintTokenInterface legacyToken = AugmintTokenInterface(msg.sender);\n        require(acceptedLegacyAugmintTokens[legacyToken], \"msg.sender must be allowed in acceptedLegacyAugmintTokens\");\n\n        legacyToken.burn(amount);\n        augmintToken.issueTo(from, amount);\n        emit LegacyTokenConverted(msg.sender, from, amount);\n    }\n\n    function getLoanToDepositRatio() external view returns (uint loanToDepositRatio) {\n        loanToDepositRatio = totalLockedAmount == 0 ? 0 : totalLockedAmount.mul(PERCENT_100).div(totalLoanAmount);\n    }\n\n    /* Helper function for UI.\n        Returns max lock amount based on minLockAmount, interestPt, using LTD params & interestEarnedAccount balance */\n    function getMaxLockAmount(uint minLockAmount, uint interestPt) external view returns (uint maxLock) {\n        uint allowedByEarning = augmintToken.balanceOf(address(interestEarnedAccount)).mul(PERCENT_100).div(interestPt);\n        uint allowedByLtd = getMaxLockAmountAllowedByLtd();\n        maxLock = allowedByEarning < allowedByLtd ? allowedByEarning : allowedByLtd;\n        maxLock = maxLock < minLockAmount ? 0 : maxLock;\n    }\n\n    /* Helper function for UI.\n        Returns max loan amount based on minLoanAmont using LTD params */\n    function getMaxLoanAmount(uint minLoanAmount) external view returns (uint maxLoan) {\n        uint allowedByLtd = getMaxLoanAmountAllowedByLtd();\n        maxLoan = allowedByLtd < minLoanAmount ? 0 : allowedByLtd;\n    }\n\n    /* returns maximum lockable token amount allowed by LTD params. */\n    function getMaxLockAmountAllowedByLtd() public view returns(uint maxLockByLtd) {\n        uint allowedByLtdDifferencePt = totalLoanAmount.mul(PERCENT_100).div(PERCENT_100\n                                            .sub(ltdParams.lockDifferenceLimit));\n        allowedByLtdDifferencePt = totalLockedAmount >= allowedByLtdDifferencePt ?\n                                        0 : allowedByLtdDifferencePt.sub(totalLockedAmount);\n\n        uint allowedByLtdDifferenceAmount =\n            totalLockedAmount >= totalLoanAmount.add(ltdParams.allowedDifferenceAmount) ?\n                0 : totalLoanAmount.add(ltdParams.allowedDifferenceAmount).sub(totalLockedAmount);\n\n        maxLockByLtd = allowedByLtdDifferencePt > allowedByLtdDifferenceAmount ?\n                                        allowedByLtdDifferencePt : allowedByLtdDifferenceAmount;\n    }\n\n    /* returns maximum borrowable token amount allowed by LTD params */\n    function getMaxLoanAmountAllowedByLtd() public view returns(uint maxLoanByLtd) {\n        uint allowedByLtdDifferencePt = totalLockedAmount.mul(ltdParams.loanDifferenceLimit.add(PERCENT_100))\n                                            .div(PERCENT_100);\n        allowedByLtdDifferencePt = totalLoanAmount >= allowedByLtdDifferencePt ?\n                                        0 : allowedByLtdDifferencePt.sub(totalLoanAmount);\n\n        uint allowedByLtdDifferenceAmount =\n            totalLoanAmount >= totalLockedAmount.add(ltdParams.allowedDifferenceAmount) ?\n                0 : totalLockedAmount.add(ltdParams.allowedDifferenceAmount).sub(totalLoanAmount);\n\n        maxLoanByLtd = allowedByLtdDifferencePt > allowedByLtdDifferenceAmount ?\n                                        allowedByLtdDifferencePt : allowedByLtdDifferenceAmount;\n    }\n\n}\n"
        }
      }
    }
  }
}